@(ownFoods: List[Food], beefcake: Beefcake)

@import helper._
@import helper.twitterBootstrap2._
@import helper.twitterBootstrap2.Bootstrap2Helpers._
@import models.Date


@main(Html("Superbeefcake"), "", Some(beefcake)) {
  @bs2Row() {
      @bs2Span(8, Some(1)) {
        <h1>Your own food entries...</h1>
        @bs2Table(List(Html("Name"), Html(""), Html("Amount"), Html("kCal"), Html("Protein"), Html("Fat"), Html("Carbs"), Html("")), 'class -> "table-condensed table-striped") {
          @ownFoods.map { ownFood => 
              <tr>
                <td> <span id="span-@ownFood.name" style="display:none;"><a href="#" id="save-@ownFood.name" class="btn btn-primary"><i class="icon-search icon-white"></i> Save</a></span></td>
                <td> <input type="text" name="name" id="name-@ownFood.name" value="@ownFood.name" class="span2 food-input" /> <input type="hidden" value="@ownFood.name" name="original_name" id="original-name-@ownFood.name" /> </td>
                <td> <input type="text" name="amount" id="amount-@ownFood.name" value="100" class="span1 food-input" /> </td>
                <td> <input type="text" name="energy" id="energy-@ownFood.name" value="@ownFood.kCal" class="span1 food-input" /> </td>
                <td> <input type="text" name="protein" id="protein-@ownFood.name" value="@ownFood.protein" class="span1 food-input" /> </td>
                <td> <input type="text" name="fat" id="fat-@ownFood.name" value="@ownFood.fat" class="span1 food-input" /> </td>
                <td> <input type="text" name="carbs" id="carbs-@ownFood.name" value="@ownFood.carbs" class="span1 food-input" /> </td>
                <td> <a tabindex="-1" href="@{routes.Application.deleteOwnFood(ownFood.name)}" style="font-weight: bold; font-size: 16px; line-height: 16px; color: black; text-shadow: 0 1px 0 white; opacity: 0.2;">x</a> </td>
              </tr>
            }
            @{/* add a new food entry */}
            <tr>
              <td> <span id="span-new" style="display:none;"><a class="btn btn-primary" id="create-new"><i class="icon-plus icon-white"></i> Add</a></span></td>
              <td> <input type="text" name="name" id="name-new" value="" placeholder="New entry..." class="span2 food-input" /> </td>
              <td> <input type="text" name="amount" id="amount-new" value="" placeholder="100" class="span1 food-input" /> </td>
              <td> <input type="text" name="kCal" id="energy-new" value="" placeholder="0" class="span1 food-input" /> </td>
              <td> <input type="text" name="protein" id="protein-new" value="" placeholder="0.0" class="span1 food-input" /> </td>
              <td> <input type="text" name="fat" id="fat-new" value="" placeholder="0.0" class="span1 food-input" /> </td>
              <td> <input type="text" name="carbs" id="carbs-new" value="" placeholder="0.0" class="span1 food-input" /> </td>
              <td> </td>
            </tr>
            <script type="text/javascript" charset="utf-8">
              // perform AJAX call when save button is clicked
              $("a[id^='save-']").click(function() {
                var foodName = $(this).attr('id').split('-')[1];
                var url = "@routes.Application.updateFood()";
                var data = {};
                data['originalName'] = $("#original-name-" + foodName).attr('value');
                data['name'] = $("#name-" + foodName).attr('value');
                data['amount'] = $("#amount-" + foodName).attr('value');
                data['energy'] = $("#energy-" + foodName).attr('value');
                data['protein'] = $("#protein-" + foodName).attr('value');
                data['fat'] = $("#fat-" + foodName).attr('value');
                data['carbs'] = $("#carbs-" + foodName).attr('value');
                $.get(url, data, function(data, textStatus, jqXHR) {
                  // data contains the foodName
                  $("a[id^='" + data + "']").hide();
                  // TODO message that all is save now
                });
              });

              // show save button on value change
              $(".food-input").keypress(function() {
                var id = $(this).attr('id');
                var foodName = id.split('-')[1];
                $("#span-" + foodName).css("display", "");
              });
              $("#create-new").click(function() {
                // set the values of the hidden form to equal the entered ones
                var fields = ["name", "amount", "energy", "protein", "fat", "carbs"];
                for(i in fields) {
                  var value = $("#" + fields[i] + "-new").attr("value");
                  $("#" + fields[i] + "-hidden").attr("value", value);
                }

                // submit
                $("#hidden-form").submit();
              });
            </script>
        }
        @form(routes.Application.submitUserFoodEntry, ('class -> "form-horizontal"), ('id->"hidden-form")) {
          <input type="hidden" name="name" id="name-hidden" value="" />
          <input type="hidden" name="amount" id="amount-hidden" value="" />
          <input type="hidden" name="kCal" id="energy-hidden" value="" />
          <input type="hidden" name="protein" id="protein-hidden" value="" /> 
          <input type="hidden" name="fat" id="fat-hidden" value="" />
          <input type="hidden" name="carbs" id="carbs-hidden" value="" />
          <input type="hidden" name="redirectTo" value="@routes.Application.manageOwnFoodEntries()" />
        }
    }
  }

  <script type="text/javascript" charset="utf-8">
      $(function(){
          // select the navbar link for this view as active
          $("#manage-foods-nav-link").closest("li").addClass("active");
      });
  </script>
}


