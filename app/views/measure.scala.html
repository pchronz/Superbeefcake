@(beefcake: Beefcake, startDate: Option[Date], endDate: Option[Date], measureEntryForm: Form[(String, Int, Int, Int, Int)], measureEntries: List[MeasureEntry])

@import helper._
@import helper.twitterBootstrap2._
@import helper.twitterBootstrap2.Bootstrap2Helpers._
@import models.Date

@main(Html("Superbeefcake!"), "", Some(beefcake)) {
	@form(routes.Application.submitMeasureDateFilter){
		<fieldset>
		@bs2Row() {
			@bs2Span(9, Some(1)) {
				<legend>Pick a period</legend>
			}
		}
		@bs2Row() {
			@bs2Span(3, Some(1)) {
				<label class="control-label">Start date</label>
				@datePicker(startDate, Some("start"))
			}
			@bs2Span(3, None) {
				<label class="control-label">End date</label>
				@datePicker(endDate, Some("end"))
			}
			<script type="text/javascript" charset="utf-8">
				$(function() {
					$("select[name^='start'], select[name^='end']").change(function() {
						$(this).closest("form").submit();
					});
				});
			</script>
		}
	}

	@bs2Row() {
		@bs2Span(6, Some(1)) {
			@bs2Table(List(Html("Date"), Html("Weight"), Html(""))){
				<tr>
					@form(routes.Application.submitMeasureEntry, ('class->"form-inline")) {
						<td>
							<input type="text" title="1..31" class="span1" name="day" placeholder="Day" value="@{Date().day.toString}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='day']").tooltip({trigger: 'focus'});
								});
							</script>
							<input type="text" title="1..12" class="span1" name="month" placeholder="Month" value="@{Date().month.toString}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='month']").tooltip({trigger: 'focus'});
								});
							</script>
							<input type="text" title="2012..2014" class="span1" name="year" placeholder="Year" value="@{Date().year.toString}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='year']").tooltip({trigger: 'focus'});
								});
							</script>
						</td>
						<td>
							<input type="hidden" name="field" value="weight" />
							<input type="text" id="input-weight-new" name="value" placeholder="Weight" class="span2" />
						</td>
						<td>
							<input type="submit" class="btn btn-primary" value="Add" />
						</td>
					}
				</tr>
				@measureEntries.filter(entry => entry.field.toLowerCase == "weight").sortBy(a=>a.time.get)(Date).reverse.map{ measureEntry =>
					<tr>
						<td>@measureEntry.time</td>
						<td>
							<input type="text" class="span1" name="value" id="measure-entry-@measureEntry.id" value="@measureEntry.value" title="Hit Enter to save">
							<script type="text/javascript" charset="utf-8">
								$(function() {
									var tooltipQuery = "#measure-entry-@measureEntry.id";

									// tooltip
									$(tooltipQuery).tooltip({trigger: "focus"});

									// ajax call
									$(tooltipQuery).change(function(){
										var newVal = $(this).val();
										$.get("@routes.Application.updateMeasureEntry(measureEntry.id.get, "weight", "")" + newVal, function(date) {
											console.log("All fine!");
										});
									});
								});
							</script>
						</td>
						<td>
							<a href="@{routes.Application.deleteMeasureEntry(measureEntry.id.get)}" style="font-weight: bold; font-size: 16px; line-height: 16px; color: black; text-shadow: 0 1px 0 white; opacity: 0.2;">x</a>
						</td>
					</tr>
				}
			}
		}
	}

	<script type="text/javascript" charset="utf-8">
		$(function(){
			// select the navbar link for this view as active
			$("#measure-nav-link").closest("li").addClass("active");

			// put the focus on the first input field
			$("#input-weight-new").focus();
		});
	</script>
}
