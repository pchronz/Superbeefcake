@(beefcake: Beefcake, date: Option[Date], measureEntryForm: Form[(String, Int, Int, Int, Int)], measureEntries: List[MeasureEntry])

@import helper._
@import helper.twitterBootstrap2._
@import helper.twitterBootstrap2.Bootstrap2Helpers._
@import models.Date

@main(Html("Superbeefcake!"), "", Some(beefcake)) {
	@bs2Row() {
		@bs2Span(6, Some(1)) {
			<select class="span1" name="day">
				@{1.to(31).map{d =>
					val dat = date match {
						case None => Date()
						case Some(dat) => dat
					}
					if(dat.day == d)
						Html("<option selected=\"selected\">" + d + "</option>")
					else 
						Html("<option>" + d + "</option>")
				}}
			</select>
			<script type="text/javascript" charset="utf-8">
				$(function() {
					updateField("day");
					$("select[name='day']").change(function() {
						updateField("day");
					});
				});
			</script>
			<select class="span1" name="month">
				@{1.to(12).map{d =>
					val dat = date match {
						case None => Date()
						case Some(dat) => dat
					}
					if(dat.month == d)
						Html("<option selected=\"selected\">" + d + "</option>")
					else 
						Html("<option>" + d + "</option>")
				}}
			</select>
			<script type="text/javascript" charset="utf-8">
				$(function() {
					updateField("month");
					$("select[name='month']").change(function() {
						updateField("month");
					});
				});
			</script>
			<select class="span1" name="year">
				@{2012.to(2015).map{d =>
					val dat = date match {
						case None => Date()
						case Some(dat) => dat
					}
					if(dat.year == d)
						Html("<option selected=\"selected\">" + d + "</option>")
					else 
						Html("<option>" + d + "</option>")
				}}
			</select>
			<script type="text/javascript" charset="utf-8">
				function updateField(scale) {
					var value = $("select[name='" + scale + "'] option:selected").val();
					console.log("updating" + value);
					$("input[type='hidden'][name='" + scale + "']").val(value);
					return true;
				};
				$(function() {
					updateField("year");
					$("select[name='year']").change(function() {
						updateField("year");
					});
				});
			</script>
		}
	}

	@bs2Row() {
		@bs2Span(6, Some(1)) {
			<img src="@routes.Assets.at("images/scale.jpg")" />
			@bs2Table(List(Html("Date"), Html("Value"), Html(""))){
				<tr>
					@form(routes.Application.submitMeasureEntry, ('class->"form-inline")) {
						<td>
							<input type="text" title="1..31" class="span1" name="day" placeholder="Day" value="@{date match {case Some(d)=>d.day.toString; case None=>Date().day.toString}}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='day']").tooltip({trigger: 'focus'});
								});
							</script>
							<input type="text" title="1..12" class="span1" name="month" placeholder="Month" value="@{date match {case Some(d)=>d.month.toString; case None=>Date().month.toString}}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='month']").tooltip({trigger: 'focus'});
								});
							</script>
							<input type="text" title="2012..2014" class="span1" name="year" placeholder="Year" value="@{date match {case Some(d)=>d.year.toString; case None=>Date().year.toString}}" />
							<script type="text/javascript" charset="utf-8">
								$(function(){
									$("input[name='year']").tooltip({trigger: 'focus'});
								});
							</script>
						</td>
						<td>
							<input type="hidden" name="field" value="weight" />
							<input type="text" id="input-weight-new" name="value" placeholder="Weight" class="span2" />
						</td>
						<td>
							<input type="submit" class="btn btn-primary" value="Add" />
						</td>
					}
				</tr>
				@measureEntries.filter(entry => entry.field.toLowerCase == "weight").sortBy(a=>a.time.get)(Date).reverse.map{ measureEntry =>
					<tr>
						<td>@measureEntry.time</td>
						<td>
							<input type="text" class="span1" name="value" id="measure-entry-@measureEntry.id" value="@measureEntry.value">
							<script type="text/javascript" charset="utf-8">
								$(function() {
									$("#measure-entry-@measureEntry.id").change(function(){
										var newVal = $(this).val();
										$.get("@routes.Application.updateMeasureEntry(measureEntry.id.get, "weight", "")" + newVal, function(date) {
											console.log("All fine!");
										});
									});
								});
							</script>
						</td>
						<td>
							<a href="@{routes.Application.deleteMeasureEntry(measureEntry.id.get)}" style="font-weight: bold; font-size: 16px; line-height: 16px; color: black; text-shadow: 0 1px 0 white; opacity: 0.2;">x</a>
						</td>
					</tr>
				}
			}
		}
	}

	<script type="text/javascript" charset="utf-8">
		$(function(){
			// select the navbar link for this view as active
			$("#measure-nav-link").closest("li").addClass("active");

			// put the focus on the first input field
			$("#input-weight-new").focus();
		});
	</script>
}
